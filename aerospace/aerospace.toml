# ============================================================================
# GLOBAL SETTINGS
# ============================================================================

start-at-login = true

automatically-unhide-macos-hidden-apps = true
enable-normalization-flatten-containers = true
enable-normalization-opposite-orientation-for-nested-containers = true

accordion-padding = 0

default-root-container-layout = 'tiles'
default-root-container-orientation = 'auto'


# ============================================================================
# SKETCHYBAR INTEGRATION
# ============================================================================

# Notify Sketchybar about workspace changes
exec-on-workspace-change = ['/bin/bash', '-c',
    'sketchybar --trigger aerospace_workspace_change FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE PREV_WORKSPACE=$AEROSPACE_PREV_WORKSPACE'
]

# Notify Sketchybar about mode changes
on-mode-changed = ['exec-and-forget sketchybar --trigger aerospace_mode_change MODE="$(aerospace list-modes --current)"']

# Notify Sketchybar about focus changes
on-focus-changed = ['exec-and-forget sketchybar --trigger aerospace_focus_change FOCUSED_WINDOW_ID=$AEROSPACE_WINDOW_ID FOCUSED_WORKSPACE=$AEROSPACE_FOCUSED_WORKSPACE']


# ============================================================================
# GAPS CONFIGURATION
# ============================================================================

[gaps]
inner.horizontal = 7
inner.vertical   = 7
outer.left       = 2
outer.right      = 2
outer.bottom     = 2
outer.top        = 7


# ============================================================================
# WORKSPACE TO MONITOR ASSIGNMENT
# ============================================================================

[workspace-to-monitor-force-assignment]
4 = ['secondary', 'main']
5 = ['secondary', 'main']


# ============================================================================
# MAIN MODE BINDINGS
# ============================================================================

[mode.main.binding]

# Disable default macOS shortcuts
cmd-alt-h = []  # Disable "hide others"
cmd-tab = []    # Disable default cmd-tab

# Mode switching
cmd-ctrl-alt-w = ['mode window']
cmd-ctrl-alt-a = ['mode apps']

# Layout toggle
cmd-ctrl-alt-enter = ['layout tiles accordion']

# Focus navigation (wrap around workspace boundaries)
cmd-ctrl-alt-left  = ['focus left --boundaries-action wrap-around-the-workspace']
cmd-ctrl-alt-right = ['focus right --boundaries-action wrap-around-the-workspace']
cmd-ctrl-alt-up    = ['focus up --boundaries-action wrap-around-the-workspace']
cmd-ctrl-alt-down  = ['focus down --boundaries-action wrap-around-the-workspace']

# Workspace navigation
cmd-ctrl-alt-shift-left  = 'workspace --wrap-around prev'
cmd-ctrl-alt-shift-right = 'workspace --wrap-around next'

# Workspace switching
cmd-ctrl-alt-1 = ['workspace 1']
cmd-ctrl-alt-2 = ['workspace 2']
cmd-ctrl-alt-3 = ['workspace 3']
cmd-ctrl-alt-4 = ['workspace 4']
cmd-ctrl-alt-5 = ['workspace 5']

# Move window to workspace
cmd-ctrl-alt-shift-1 = ['move-node-to-workspace 1 --focus-follows-window']
cmd-ctrl-alt-shift-2 = ['move-node-to-workspace 2 --focus-follows-window']
cmd-ctrl-alt-shift-3 = ['move-node-to-workspace 3 --focus-follows-window']
cmd-ctrl-alt-shift-4 = ['move-node-to-workspace 4 --focus-follows-window']
cmd-ctrl-alt-shift-5 = ['move-node-to-workspace 5 --focus-follows-window']


# ============================================================================
# WINDOW MODE BINDINGS
# ============================================================================

[mode.window.binding]

# Move windows
left  = 'move left'
right = 'move right'
up    = 'move up'
down  = 'move down'

# Join windows
shift-ctrl-alt-left  = ['join-with left']
shift-ctrl-alt-right = ['join-with right']
shift-ctrl-alt-up    = ['join-with up']
shift-ctrl-alt-down  = ['join-with down']

# Resize windows
shift-left  = ['resize width -75']
shift-right = ['resize width +75']
shift-up    = ['resize height +75']
shift-down  = ['resize height -75']

# Utilities
b = ['balance-sizes', 'mode main']
q = [
    'exec-and-forget brew services restart felixkratz/formulae/borders',
    'exec-and-forget brew services restart felixkratz/formulae/sketchybar',
    'reload-config',
    'mode main'
]
backspace = ['reload-config', 'mode main']

# Exit window mode
enter = ['mode main']
esc   = ['mode main']


# ============================================================================
# APPS MODE BINDINGS
# ============================================================================

[mode.apps.binding]

# Browsers
a = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Arc.app', 'mode main']
b = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Brave\ Browser.app', 'mode main']
z = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Zen.app', 'mode main']

# Development tools
d = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=~/Applications/IntelliJ\ IDEA.app', 'mode main']
j = ["exec-and-forget osascript -e 'tell application id \"net.java.openjdk.java\" to activate'"]
p = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Postman.app', 'mode main']
v = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Visual\ Studio\ Code.app', 'mode main']
w = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Warp.app', 'mode main']

# Communication
g = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/ChatGPT.app', 'mode main']
m = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Notion\ Mail.app', 'mode main']
t = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Microsoft\ Teams.app', 'mode main']

# Productivity
c = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Notion\ Calendar.app', 'mode main']
e = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Microsoft\ Excel.app', 'mode main']

# System & utilities
f = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/System/Library/CoreServices/Finder.app', 'mode main']
i = ['exec-and-forget open -b com.apple.systempreferences', 'mode main']
s = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/Applications/Spotify.app', 'mode main']

# Quick links
f10 = ['exec-and-forget open https://github.com/festina-advisor/advisor/pulls/krn_festina', 'mode main']
f11 = ['exec-and-forget open https://github.com/notifications?query=is:unread', 'mode main']
f12 = ['exec-and-forget sketchybar --trigger aerospace_app_open APP_PATH=/System/Applications/Messages.app', 'mode main']

# Exit apps mode
enter = ['mode main']
esc   = ['mode main']


# ============================================================================
# WINDOW DETECTION RULES
# ============================================================================

# Finder windows should float
[[on-window-detected]]
if.app-id = 'com.apple.finder'
run = ['layout floating']

# System Preferences should float
[[on-window-detected]]
if.app-id = 'com.apple.systempreferences'
run = ['layout floating']

# IntelliJ debugger and tool windows should float
[[on-window-detected]]
if.app-id = 'com.jetbrains.intellij'
if.window-title-regex-substring = '.*(Debug|Evaluate|Breakpoint|Variable|Console|Find|Replace).*'
run = ['layout floating']

# IntelliJ settings dialogs should float
[[on-window-detected]]
if.app-id = 'com.jetbrains.intellij'
if.window-title-regex-substring = '^(Preferences|Settings|Project Structure)$'
run = ['layout floating']
